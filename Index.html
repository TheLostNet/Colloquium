<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Shadow Garden Zugang</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Courier New', Courier, monospace;
    }
    body {
      background-color: #0a0a0a;
      color: #f5f5f5;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      overflow: hidden;
    }
    .container {
      text-align: center;
      opacity: 0;
      transition: opacity 2s ease-in-out;
    }
    .logo {
      width: 150px;
      height: auto;
      margin-bottom: 30px;
      filter: drop-shadow(0 0 10px #fff3);
    }
    h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
    }
    p {
      margin-bottom: 20px;
    }
    input, select, button {
      background: #111;
      border: 1px solid #555;
      color: #f5f5f5;
      padding: 10px;
      margin: 5px;
      border-radius: 5px;
    }
    button {
      cursor: pointer;
      transition: background 0.3s ease;
    }
    button:hover {
      background: #222;
    }
    #intro {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: black;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      animation: fadeOut 4s forwards;
      animation-delay: 0.5s;
    }
    @keyframes fadeOut {
      0% { opacity: 1; }
      100% { opacity: 0; display: none; }
    }
  </style>
</head>
<body>

  <div id="intro">Willkommen im Schatten...</div>

  <audio id="introSound" src="./intro.mp3" preload="auto"></audio>
  <audio id="clickSound" src="./click.mp3" preload="auto"></audio>

  <div class="container" id="mainContent">
    <img src="./logo.png" alt="Shadow Garden Logo" class="logo" />
    <h1>Zugang zum Shadow Garden</h1>
    <p>Deine Entscheidung erwartet dich...</p>
    <input type="text" id="name" placeholder="Dein Codename...">
    <button onclick="verify()">Weiter</button>
    <div id="formSection" style="display:none; margin-top: 20px;">
      <select id="choice">
        <option value="question">Frage</option>
        <option value="answer">Antwort</option>
      </select>
      <button onclick="validateForm()">Absenden</button>
      <button onclick="goBack()">Zurück</button>
    </div>
  </div>

  <script>
    const allowedNames = [
      "7[]x§~4;;8;+9_.a!-3ä2y<<w][x§~9_.",
      "q//"
    ];

    const encryptTable = {
      a: "1", b: "2", c: "3", d: "4", e: "5", f: "6", g: "7",
      h: "8", i: "9", j: ";", k: "+", l: "-", m: ".", n: "/",
      o: "=", p: "?", q: "@", r: "[", s: "]", t: "^", u: "_",
      v: "`", w: "~", x: "<", y: ">", z: "!", 
      A: "a", B: "b", C: "c", D: "d", E: "e", F: "f", G: "g",
      H: "h", I: "i", J: "j", K: "k", L: "l", M: "m", N: "n",
      O: "o", P: "p", Q: "q", R: "r", S: "s", T: "t", U: "u",
      V: "v", W: "w", X: "x", Y: "y", Z: "z"
    };

    function encrypt(text) {
      return text.split('').map(char => encryptTable[char] || char).join('');
    }

    const audioContext = new (window.AudioContext || window.webkitAudioContext)();
    let introGain = audioContext.createGain();

    function playSoundWithFade(audioElement, gainNode, fadeIn = 0.5, fadeOut = 0.5) {
      const source = audioContext.createMediaElementSource(audioElement);
      source.connect(gainNode).connect(audioContext.destination);

      const now = audioContext.currentTime;
      gainNode.gain.setValueAtTime(0, now);
      gainNode.gain.linearRampToValueAtTime(1, now + fadeIn);

      audioElement.currentTime = 0;
      audioElement.play();

      if (fadeOut > 0) {
        const duration = audioElement.duration || 2;
        gainNode.gain.setValueAtTime(1, now + duration - fadeOut);
        gainNode.gain.linearRampToValueAtTime(0, now + duration);
      }
    }

    function playClick() {
      const audio = document.getElementById("clickSound").cloneNode();
      const tempSource = audioContext.createMediaElementSource(audio);
      const tempGain = audioContext.createGain();
      tempSource.connect(tempGain).connect(audioContext.destination);
      const now = audioContext.currentTime;

      tempGain.gain.setValueAtTime(0, now);
      tempGain.gain.linearRampToValueAtTime(1, now + 0.05);
      tempGain.gain.linearRampToValueAtTime(0, now + 0.4);

      audio.play();
    }

    function verify() {
      playClick();
      const nameInput = document.getElementById("name").value.trim();
      const encrypted = encrypt(nameInput);
      if (allowedNames.includes(encrypted)) {
        document.getElementById("formSection").style.display = "block";
      } else {
        alert("Zugriff verweigert.");
      }
    }

    function validateForm() {
      playClick();
      const choice = document.getElementById("choice").value;
      alert("Du hast dich entschieden: " + choice);
    }

    function goBack() {
      playClick();
      document.getElementById("formSection").style.display = "none";
    }

    window.addEventListener("load", () => {
      const intro = document.getElementById("intro");
      const main = document.getElementById("mainContent");
      const introSound = document.getElementById("introSound");

      let triggered = false;

      const beginExperience = () => {
        if (triggered) return;
        triggered = true;

        audioContext.resume().then(() => {
          playSoundWithFade(introSound, introGain, 1, 0);
        });

        intro.style.animationPlayState = 'running';
        setTimeout(() => {
          intro.style.display = 'none';
          main.style.opacity = 1;
        }, 4000);
      };

      document.body.addEventListener("click", beginExperience);
      document.body.addEventListener("keydown", beginExperience);

      setTimeout(() => {
        audioContext.resume().then(() => {
          playSoundWithFade(introSound, introGain, 1, 0);
        });
      }, 300);
    });
  </script>
</body>
</html>
